name: Dependency Security Check
on: [push, pull_request]

env:
    GITHUB_USERNAME: github-actions
    GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}

jobs:
    check-dependencies:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup .NET 10
              uses: actions/setup-dotnet@v4
              with:
                  dotnet-version: 10.0.x

            - name: Authenticate GitHub Packages
              run: |
                  dotnet nuget remove source github || true
                  dotnet nuget add source \
                    https://nuget.pkg.github.com/Sundy-Studios/index.json \
                    --name github \
                    --username Sundy0828 \
                    --password ${{ secrets.PERSONAL_PAT }} \
                    --store-password-in-clear-text

            - name: Restore dependencies
              run: dotnet restore

            - name: Check for vulnerable packages
              run: dotnet list package --vulnerable
